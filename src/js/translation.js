const TranslationData = [
  [`Overview`, `概览`],
  [`Repositories`, `仓库`],
  [`Projects`, `项目`],
  [`Packages`, `包`],
  [`Stars`, `收藏`],

  [`Sort`, `排序`],
  [`Sort by`, `排序方式`],
  [`Lists`, `列表 `],
  [`{0} Inspiration`, `{0} 灵感`],
  [`{0} My stack`, `{0} 我的技术栈`],
  [`{0} Future ideas`, `{0} 未来想法`],
  [`Search`, `搜索`],

  [`Create new...`, `创建新...`],
  [`New repository`, `新建仓库`],
  [`Import repository`, `导入仓库`],
  [`New codespace`, `新建代码空间`],
  [`New gist`, `新建代码片段`],
  [`New organization`, `新建组织`],
  [`New project`, `新建项目`],

  [`Account switcher`, `账户切换器`],
  [`Close`, `关闭`],
  [`Your profile`, `你的个人资料`],
  [`Your repositories`, `你的仓库`],
  [`Your Copilot`, `你的 Copilot`],
  [`Your projects`, `你的项目`],
  [`Your stars`, `你的收藏`],
  [`Your gists`, `你的代码片段`],
  [`Your organizations`, `你的组织`],
  [`Your enterprises`, `你的企业`],
  [`Your sponsors`, `你的赞助者`],
  [`Try Enterprise`, `试用企业版`],
  [`Free`, `免费`],
  [`Feature preview`, `功能预览`],
  [`Settings`, `设置`],
  [`GitHub Website`, `GitHub 网站`],
  [`GitHub Docs`, `GitHub 文档`],
  [`GitHub Support`, `GitHub 支持`],
  [`GitHub Community`, `GitHub 社区`],
  [`Sign out`, `登出`],

  // settings/profile
  [`Your personal account`, `你的个人账户`],
  [`Switch settings context`, `切换设置上下文`],
  [`Go to your personal profile`, `前往你的个人资料`],
  [`Public profile`, `公开资料`],
  [`Profile picture`, `个人资料图片`],
  [`Edit`, `编辑`],
  [`Name`, `姓名`],
  [`Your name may appear around GitHub where you contribute or are mentioned. You can remove it at any time.`, `你的姓名可能会出现在你贡献或被提及的 GitHub 上。你可以随时删除它。`],
  [`Public email`, `公开邮箱`],
  [`Select a verified email to display`, `选择一个已验证的邮箱进行显示`],
  [`You have set your email address to private. To toggle email privacy, go to`, `你已将你的邮箱地址设置为私密。要切换邮箱隐私，请前往 `],
  [`email settings`, `邮箱设置`],
  [`and uncheck "Keep my email address private."`, ` 并取消选中“保持我的邮箱地址私密”。`],
  [`Bio`, `简介`],
  [`Tell us a little bit about yourself`, `告诉我们一些关于你自己的事情`],
  [`You can`, `你可以 `],
  [`other users and organizations to link to them.`, ` 其他用户和组织可以链接到它们。`],
  [`Pronouns`, `代词`],
  [`Don't specify`, `不指定`],
  [`they/them`, `他们/她们`],
  [`she/her`, `她/她`],
  [`he/him`, `他/他`],
  [`Custom`, `自定义`],
  [`URL`, `网址`],
  [`ORCID provides a persistent identifier - an ORCID iD - that distinguishes you from other researchers. Learn more at`, `ORCID 提供了一个持久的标识符 - ORCID iD - 用于区分你和其他研究人员。了解更多信息请访问 `],
  [`Connect your ORCID iD`, `连接你的 ORCID iD`],
  [`Social accounts`, `社交账户`],
  [`Link to social profile 1`, `链接到社交资料 1`],
  [`Link to social profile 2`, `链接到社交资料 2`],
  [`Link to social profile 3`, `链接到社交资料 3`],
  [`Link to social profile 4`, `链接到社交资料 4`],
  [`Company`, `公司`],
  [`your company’s GitHub organization to link it.`, ` 你的公司的 GitHub 组织以链接它。`],
  [`Location`, `位置`],
  [`Display current local time`, `显示当前本地时间`],
  [`Other users will see the time difference from their local time.`, `其他用户将看到与他们本地时间的时差。`],
  [`Time zone`, `时区`],
  [`All of the fields on this page are optional and can be deleted at any time, and by filling them out, you're giving us consent to share this data wherever your user profile appears. Please see our`, `此页面上的所有字段都是可选的，可以随时删除，通过填写这些字段，你同意我们在你的用户资料出现的任何地方共享这些数据。请参阅我们的 `],
  [`privacy statement`, `隐私声明`],
  [`to learn more about how we use this information.`, ` 以了解我们如何使用这些信息。`],
  [`Update profile`, `更新资料`],
  [`Contributions & activity`, `贡献与活动`],
  [`Make profile private and hide activity`, `将个人资料设为私密并隐藏活动`],
  [`Enabling this will hide your contributions and activity from your GitHub profile and from social features like followers, stars, feeds, leaderboards and releases.`, `启用此选项将隐藏你的贡献和活动，无法在你的 GitHub 个人资料以及关注者、收藏、动态、排行榜和版本等社交功能中显示。`],
  [`Include private contributions on my profile`, `在我的个人资料中包含私有贡献`],
  [`Your contribution graph, achievements, and activity overview will show your private contributions without revealing any repository or organization information.`, `你的贡献图表、成就和活动概览将显示你的私有贡献，而不会透露任何仓库或组织信息。 `],
  [`Read more`, `阅读更多`],
  [`Update preferences`, `更新偏好设置`],
  [`Profile settings`, `个人资料设置`],
  [`Show Achievements on my profile`, `在我的个人资料上显示成就`],
  [`Your achievements will be shown on your profile.`, `你的成就将显示在你的个人资料上。`],
  [`GitHub Developer Program`, `GitHub 开发者计划`],
  [`Building an application, service, or tool that integrates with GitHub?`, `正在构建一个与 GitHub 集成的应用程序、服务或工具吗？`],
  [`Join the GitHub Developer Program`, `加入 GitHub 开发者计划`],
  [`, or read more about it at our`, `，或在我们的 `],
  [`GitHub developer program`, `GitHub 开发者计划`],
  [`Jobs profile`, `职位资料`],
  [`Available for hire`, `可供雇佣`],
  [`Save jobs profile`, `保存职位资料`],
  [`Trending settings`, `趋势设置`],
  [`Preferred spoken language`, `首选语言`],
  [`We'll use this language preference to filter the trending repository lists on`, `我们将使用此语言偏好来过滤 `],
  [`Explore`, `探索`],
  [`our`, ` 我们的 `],
  [`Trending Repositories`, `趋势仓库`],
  [`page.`, ` 页面。`],
  [`Save Trending settings`, `保存趋势设置`],

  // settings/admin
  [`Account`, `账户`],
  [`Change username`, `更改用户名`],
  [`Changing your username can have`, `更改用户名可能会有 `],
  [`unintended side effects`, `意外的副作用`],
  [`Looking to manage account security settings? You can find them in the`, ` 想要管理账户安全设置？你可以在 `],
  [`Password and authentication`, `密码和身份验证`],
  [`Link Patreon account`, `链接 Patreon 账户`],
  [`Connect a Patreon account for`, `连接一个 Patreon 账户以 `],
  [`to sponsor maintainers with. Get recognition on GitHub for sponsorships made on Patreon when the sponsored person has linked Patreon and GitHub, too, and has a public GitHub Sponsors profile.`, ` 用于赞助维护者。当被赞助的人也链接了 Patreon 和 GitHub，并且有一个公开的 GitHub Sponsors 个人资料时，可以在 GitHub 上获得对 Patreon 赞助的认可。`],
  [`Connect with Patreon`, `连接到 Patreon`],
  [`Export account data`, `导出账户数据`],
  [`Export all repositories and profile metadata for`, `导出所有仓库和个人资料元数据以供 `],
  [`. Exports will be available for 7 days.`, `。导出将在 7 天内可用。`],
  [`Start export`, `开始导出`],
  [`Successor settings`, `继任者设置`],
  [`By clicking "Add Successor" below, I acknowledge that I am the owner of the {0} account, and am authorizing GitHub to transfer content within that account to my GitHub Successor,`, `通过点击下面的“添加继任者”，我确认我是 {0} 账户的所有者，并授权 GitHub 将该账户中的内容转移给我的 GitHub 继任者，`],
  [`designated below`, `指定如下`],
  [`, in the event of my death. I understand that this appointment of a successor does not override legally binding next-of-kin rules or estate laws of any relevant jurisdiction, and does not create a binding will.`, `，以防我去世。我理解，这种继任者的任命不会覆盖任何相关司法管辖区的法律继承规则或遗产法，也不会创建具有约束力的遗嘱。`],
  [`Learn more about account successors.`, `了解有关账户继任者的更多信息。`],
  [`Search by username, full name, or email address`, `按用户名、全名或电子邮件地址搜索`],
  [`Add Successor`, `添加继任者`],
  [`You have not designated a successor.`, `你尚未指定继任者。`],
  [`Delete account`, `删除账户`],
  [`Your account is currently an owner in these organizations:`, `你的账户目前是以下组织的所有者：`],
  [`You must`, `你必须 `],
  [`remove yourself`, `移除自己`],
  [`transfer ownership`, `转移所有权`],
  [`, or`, `，或 `],
  [`delete these organizations`, `删除这些组织`],
  [`before you can delete your user.`, `，然后才能删除你的用户。`],
  [`Delete your account`, `删除你的账户`],

  // settings/appearance
  [`Appearance`, `外观`],
  [`Theme preferences`, `主题偏好`],
  [`Choose how GitHub looks to you. Select a single theme, or sync with your system and automatically switch between day and night themes. Selections are applied immediately and saved automatically.`, `选择 GitHub 对你来说的外观。选择一个主题，或与系统同步并自动在日间和夜间主题之间切换。选择会立即应用并自动保存。`],
  [`Theme mode`, `主题模式`],
  [`Single theme`, `单一主题`],
  [`Sync with system`, `与系统同步`],
  [`GitHub will use your selected theme`, `GitHub 将使用你选择的主题`],
  [`Beta`, `测试版`],
  [`Light default`, `浅色默认`],
  [`Light high contrast`, `浅色高对比度`],
  [`Light Protanopia & Deuteranopia`, `浅色红绿色盲`],
  [`Light Tritanopia`, `浅色蓝黄色盲`],
  [`Dark default`, `深色默认`],
  [`Dark high contrast`, `深色高对比度`],
  [`Dark Protanopia & Deuteranopia`, `深色红绿色盲`],
  [`Dark Tritanopia`, `深色蓝黄色盲`],
  [`Dark dimmed`, `深色调暗`],
  [`Emoji skin tone preference`, `表情符号肤色偏好`],
  [`Preferred default emoji skin tone`, `首选默认表情符号肤色`],
  [`Tab size preference`, `标签大小偏好`],
  [`Choose the number of spaces a tab is equal to when rendering code`, `选择在渲染代码时制表符等于的空格数`],
  [`Markdown editor font preference`, `Markdown 编辑器字体偏好`],
  [`Font preference for plain text editors that support Markdown styling (e.g. pull request and issue descriptions, comments.)`, `支持 Markdown 样式的纯文本编辑器的字体偏好（例如拉取请求和问题描述、评论）。`],
  [`Use a fixed-width (monospace) font when editing Markdown`, `\t在编辑 Markdown 时使用等宽（等距）字体`],

  // settings/accessibility
  [`Accessibility`, `无障碍访问`],
  [`Keyboard shortcuts`, `键盘快捷键`],
  [`General`, `通用`],
  [`Character keys`, `\t字符键`],
  [`Enable`, `启用 `],
  [`GitHub shortcuts`, `GitHub 快捷键`],
  [`that don't use modifier keys in their activation. For example, the`, ` 不使用修饰键激活的 GitHub 快捷键。例如 `],
  [`shortcut to navigate notifications, or`, ` 用于导航通知的快捷键，或 `],
  [`to view context relevant shortcuts.`, ` 用于查看上下文相关的快捷键。`],
  [`Learn more about character key shortcuts`, `了解有关字符键快捷键的更多信息`],
  [`Save keyboard shortcut preferences`, `保存键盘快捷键偏好`],
  [`Command Palette`, `命令面板`],
  [`Modify the shortcuts to trigger the Command Palette for the default search mode and the command mode`, `修改触发默认搜索模式和命令模式的命令面板的快捷键 `],
  [`Search mode`, `搜索模式`],
  [`Command mode`, `命令模式`],
  [`Save command palette preferences`, `保存命令面板偏好`],
  [`Motion`, `动作`],
  [`Autoplay animated images`, `自动播放动画图像`],
  [`Select whether animated images should play automatically.`, `选择是否自动播放动画图像。`],
  [`Adopts your system preference for reduced motion`, `采用你的系统偏好设置以减少运动效果`],
  [`Enabled`, `已启用`],
  [`Automatically plays animated images`, `自动播放动画图像`],
  [`Disabled`, `已禁用`],
  [`Prevents animated images from playing automatically`, `防止动画图像自动播放`],
  [`Save motion preferences`, `保存运动偏好`],
  [`Content`, `内容`],
  [`Link underlines`, `链接下划线`],
  [`Toggle the visibility of underlines on links that are adjacent to text.`, `切换链接下划线的可见性，这些链接与文本相邻。`],
  [`Hide link underlines`, `隐藏链接下划线`],
  [`Show link underlines`, `显示链接下划线`],
  [`Save content preferences`, `保存内容偏好`],
  [`Hovercards`, `悬停卡片`],
  [`Enable previewing link content via mouse hover or keyboard focus before navigation. Move focus to hovercard content using`, `通过鼠标悬停或键盘焦点启用预览链接内容，然后再导航。使用 `],
  [`Save hovercard preferences`, `保存悬停卡片偏好`],
  [`Editor settings`, `编辑器设置`],
  [`URL paste behavior`, `URL 粘贴行为`],
  [`Select if URLs should be formatted on paste. You can use`, `选择是否在粘贴时格式化 URL。你可以使用 `],
  [`to paste a link in the opposite way.`, ` 来以相反的方式粘贴链接。`],
  [`Formatted link`, `格式化链接`],
  [`Pasting a URL while having text selected will format to a Markdown link`, `在选中文本时粘贴 URL 将格式化为 Markdown 链接`],
  [`Plain text`, `纯文本`],
  [`Pasting a URL while having text selected will replace the text`, `在选中文本时粘贴 URL 将替换文本`],
  [`Save editor settings`, `保存编辑器设置`],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
  [``],
];

const MutationObserverConfig = {
  childList: true,
  subtree: true,
  attributeFilter: ["data-label"],
  characterData: true,
};

// 将字符串中的占位符转换为正则表达式模式
function createPlaceholderPattern (str) {
  // 转义字符串中的正则特殊字符
  let escaped = str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  // 将 {0}, {1}, ... 替换为捕获组
  return new RegExp('^' + escaped.replace(/\\\{(\d+)\\\}/g, '(.*?)') + '$');
}

// 处理占位符的函数
function replacePlaceholders (translated, original, matches) {
  return translated.replace(/{(\d+)}/g, (match, index) => {
    return matches[parseInt(index) + 1] || match;
  });
}

// 构建翻译映射，包含正则表达式模式
function buildTranslationMap () {
  const map = new Map();
  const patterns = [];

  TranslationData.forEach(([key, val]) => {
    if (!key) return;

    // 普通字符串映射（无占位符）
    if (!key.includes('{')) {
      map.set(key, { translation: val, pattern: null });
    }
    // 包含占位符的字符串，创建正则表达式模式
    else {
      const pattern = createPlaceholderPattern(key);
      patterns.push({ pattern, translation: val });
    }
  });

  return { map, patterns };
}

const { map: dataMap, patterns: placeholderPatterns } = buildTranslationMap();

const observer = new MutationObserver(function (mutations) {
  const treeWalker = document.createTreeWalker(
    document.body,
    NodeFilter.SHOW_ALL,
    {
      acceptNode: function (node) {
        if (
          node.nodeType === 3 ||
          (node.hasAttribute &&
            (node.hasAttribute("data-label") ||
              node.hasAttribute("placeholder") ||
              node.hasAttribute("value")))
        ) {
          return NodeFilter.FILTER_ACCEPT;
        } else {
          return NodeFilter.FILTER_SKIP;
        }
      },
    },
    false
  );

  let currentNode = treeWalker.currentNode;
  while (currentNode) {
    let originalText = '';

    if (currentNode.nodeType === 3) {
      originalText = currentNode.textContent.trim().replace(/\s+/g, ' ');
    } else {
      originalText = currentNode.getAttribute("data-label") ||
        currentNode.getAttribute("placeholder") ||
        currentNode.getAttribute("value") || '';
      originalText = originalText.trim().replace(/\s+/g, ' ');
      if (!originalText) {
        currentNode = treeWalker.nextNode();
        continue;
      }
    }

    // 首先检查普通字符串映射
    let translationInfo = dataMap.get(originalText);

    // 如果没有找到，检查占位符模式
    if (!translationInfo) {
      for (const { pattern, translation } of placeholderPatterns) {
        const matches = originalText.match(pattern);
        if (matches) {
          translationInfo = { translation, matches };
          break;
        }
      }
    }

    // 应用翻译
    if (translationInfo) {
      let translated = translationInfo.translation;

      // 如果有占位符匹配，替换它们
      if (translationInfo.matches) {
        translated = replacePlaceholders(translated, originalText, translationInfo.matches);
      }

      // 更新节点内容
      if (currentNode.nodeType === 3) {
        currentNode.textContent = translated;
      } else {
        if (currentNode.hasAttribute("data-label")) {
          currentNode.setAttribute("data-label", translated);
        }
        if (currentNode.hasAttribute("placeholder")) {
          currentNode.setAttribute("placeholder", translated);
        }
        if (currentNode.hasAttribute("value")) {
          currentNode.setAttribute("value", translated);
        }
      }
    }

    currentNode = treeWalker.nextNode();
  }
});

observer.observe(document.body, MutationObserverConfig);